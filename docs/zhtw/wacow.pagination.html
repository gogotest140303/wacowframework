<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 7. Wacow_Pagination (分頁) </title>
<link href="styles/main.css" rel="stylesheet" type="text/css" />
</head>

<body>
<h1>Chapter 7. Wacow_Pagination (分頁)</h1>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#introduction">7.1 簡介</a>
<ul>
<li><a href="#how_to_pagination">7.1.1 如何分頁</a></li>
</ul>
</li>
<li><a href="wacow.pagination.pager.html">7.2 分頁器
</a>
<ul>
<li><a href="wacow.pagination.pager.html">7.2.1 基本分頁器</a></li>
<li><a href="wacow.pagination.pager.html">7.2.2 滑動式分頁器</a></li>
<li><a href="wacow.pagination.pager.html">7.2.3 自訂分頁器</a></li>
</ul>
</li>
<li><a href="wacow.pagination.ui.html">7.3 使用者介面
</a>
<ul>
<li><a href="wacow.pagination.ui.html">7.3.1 一般連結式分頁介面</a></li>
<li><a href="wacow.pagination.ui.html">7.3.2 下拉選單式分頁介面</a></li>
<li><a href="wacow.pagination.ui.html">7.3.3 自訂使用者介面</a></li>
</ul>
</li>
</ul>
<h2 id="introduction">7.1 簡介</h2>
<p>大部份談到分頁，我們都會想到要對從資料庫中取得的結果集做分頁。不過事實上我們可以對任何過長的資料來做分頁，像是 RSS Feed 、 Log File 等等。</p>
<p>Wacow 框架提供了一組分頁器及分頁介面，讓開發者可以針對需要分頁的資料做適當的處理。 </p>
<h3 id="how_to_pagination">7.1.1 如何分頁</h3>
<p>在 Wacow 框架裡，開發者可以對想要提供分頁功能的類別實作 <code>Wacow_Pagination_Pagable_Interface</code> 這個介面。這個介面主要提供以下三個方法：</p>
<pre><code>setPager(Wacow_Pagination_Pager_Abstract $pager) // 指定分頁器</code></pre>
<p>這個方法主要是讓外部的分頁器能夠對我們內部的資料做分頁的動作，<strong>它必須在取得結果集之前，由用戶端程式自行呼叫。</strong></p>
<pre><code>getTotalSize() // 取得資料總筆數</code></pre>
<p>這裡我們必須回傳類別內部結果介集的總筆數，<strong>此方法會由分頁器自動呼叫。</strong></p>
<pre><code>setPageRange($offset, $count) // 設定分頁範圍</code></pre>
<p><strong>在分頁器計算好分頁筆數後，會自動呼叫此方法。</strong>這時候我們在此方法內要依照分頁器傳來的 <code>$offset</code> (起始筆數) 和 <code>$count</code> (取得筆數) 兩個參數，來設定結果集要輸出的範圍。而在真正取得資料時，我們會透過另一個方法來處理，例如 <code>Wacow_Model</code> 中的 <code>fetchAll</code> 方法；這時我們就必須把剛剛 <code>$offset</code> 和 <code>$count</code> 傳給  <code>fetchAll</code> 方法，以取得正確範圍的結果集。 </p>
<p>只要類別中實作這三個方法，我們就能夠讓這個類別有分頁的功能，然而前提是裡面的資料必須是有連貫性的 (例如陣列) 。以下我們用陣列來做為簡單的例子：</p>
<pre><code>&lt;?php

require_once 'Wacow/Pagination/Pagable/Interface.php';

class TestModel implements Wacow_Pagination_Pagable_Interface
{
    // 內部資料集
    private $content = array ();
    
    // 建構函式
    public function __construct()
    {
        // 產生一個包含 0 ~ 81 的陣列資料集
        $this-&gt;content = range(0, 81);
    }

    // 設定分頁器
    public function setPager(Wacow_Pagination_Pager_Abstract $pager)
    {
        $pager-&gt;setPagable($this);
    }

    // 取得總筆數
    public function getTotalSize()
    {
        // 陣列可用 count 回傳總筆數
        return count($this-&gt;content);
        
        // 實際應用時應該使用適合該資料集的做法
    }

    // 設定分頁範圍
    public function setPageRange($offset, $count)
    {
        // 分頁關鍵，這裡是利用 array_slice 函式來完成
        $this-&gt;content = array_slice($this-&gt;content, $offset, $count);
    }

    // 回傳結果集
    public function fetchAll()
    {
        return $this-&gt;content;
        
        // 我們也可以在此做分頁動作，只要在 setPageRange 方法中記住
        // $offset 和 $count ，然後把 array_slice 的動作移到此處即可
    }
}</code></pre> 
<p>後面我們將會提到如何使用分頁器來對此類別做分頁動作。</p>
</body>
</html>
